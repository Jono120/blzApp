@page "/details/{ClientId:int}"

@using Microsoft.AspNetCore.Components
@using Microsoft.AspNetCore.Razor.TagHelpers
@using Microsoft.EntityFrameworkCore
@using blzCPS.Components.Models
@using blzCPS.Data
@using Microsoft.AspNetCore.Components.Forms
@using blzCPS.Components.Pages.Clients.Models
@using static Microsoft.EntityFrameworkCore.DbLoggerCategory

@rendermode InteractiveServer
@inject IDbContextFactory<blzCPSContext> DbFactory
@inject NavigationManager Navigation

<PageTitle>Details</PageTitle>

@code {

    [Parameter]
    public int ClientId { get; set; }

    private blzClients Clients = new blzClients();
    private bool Loading { get; set; } = true;
    private bool NotFound { get; set; } = false;

    protected override async Task OnInitializedAsync()
    {
        using var context = DbFactory.CreateDbContext();
        Clients = await context.Clients.FindAsync(ClientId);

        if (Clients == null)
        {
            NotFound = true;
        }

        Loading = false;
    }
}

<h1>Details</h1>

@if (NotFound && !Loading)
{
    <div class="alert alert-warning">A client with that ID doesn't exist.</div>
}
else if (Clients is null || Loading)
{
    <div class="alert alert-info">Loading...</div>
}
else
{
    <div>
        <h4>Client</h4>
        <hr />
        <dl class="row">
            <dt class="col-sm-2">Staff Member Name</dt>
            <dd class="col-sm-10">@Clients.StaffMemberName</dd>
            <dt class="col-sm-2">Name</dt>
            <dd class="col-sm-10">@Clients.ClientName</dd>
            <dt class="col-sm-2">Phone Number</dt>
            <dd class="col-sm-10">@Clients.ClientPhoneNumber</dd>
            <dt class="col-sm-2">Email</dt>
            <dd class="col-sm-10">@Clients.ClientEmail</dd>
            <dt class="col-sm-2">Location</dt>
            <dd class="col-sm-10">@Clients.ClientLocation</dd>
            <dt class="col-sm-2">Has Been Contacted</dt>
            <dd class="col-sm-10">@Clients.HasBeenContacted</dd>
            <dt class="col-sm-2">Notes</dt>
            <dd class="col-sm-10">@Clients.ClientNotes</dd>
        </dl>
    </div>
    <div class="d-row gap-2 d-md-block">
        <a href="/edit/@Clients.ClientId" class="btn btn-primary">Edit</a>
        <a href="/view" class="btn btn-secondary">Back to List</a>
    </div>
}